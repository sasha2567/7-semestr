;;;; 2015-10-12 10:53:47
;;;; This is your lisp file. May it serve you well.

(defun lab1_func_list(x y z)
  (let* ((l1 (list x y z)))
    (when (NUMBERP (second l1))
      (when (or (EQUAL (rem (second l1) 7) 0) (EQUAL (rem (second l1) 5) 0))
        (setf res l1)
        (setf (SECOND res) 35)
        res
      )
    )
    (and
      (append (list (first l1)) (cddr l1))
    )
  )
)

(defun lab2_atom_from_list(x y)
  (let* ((l2 x))
    (setf k 0)
    (dolist (z l2)
      (when (atom z)
        (setf k (+ k 1))
      )
      (when (= k y)
        (return z)
      )
    )
  )
)

(defun lab2_atom_from_list_rec(x y &optional z)
  (if(= 0 y)
    z
    (if (atom (car x))
	  (lab2_atom_from_list_rec (cdr x) (- y 1) (car x))
	  (lab2_atom_from_list_rec (cdr x) y (car x))
	)
  )
)


(defun lrtrace(n k)
  (trace lab2_atom_from_list_rec)
  (lab2_atom_from_list_rec n k)
  (untrace lab2_atom_from_list_rec)
)

;(LAB2_ATOM_FROM_LIST_REC (list 1 2 3 (list 4 5) 6 7) 2)
;(lrtrace (list 1 2 3 (list 4 5) 6 7) 2)

(defun CreateDB (a b c d e f g)
  (adjoin (list :number a :fio b :yearb c :yearp d :markF e :markVM f :markPr g) nil)
)

(defun AddRow(db a b c d e f g)
  (adjoin (list :number a :fio b :yearb c :yearp d :markF e :markVM f :markPr g) db)
)

(defun SaveDB(db filePath)
  (with-open-file (out filePath
                   :direction :output
                   :if-exists :supersede)
    (with-standard-io-syntax
      (print db out)
    )
  )
)

(defun ReadDB (filePath)
  (with-open-file (in filePath)
    (with-standard-io-syntax
      (read in)
    )
  )
)

(defun Update (db selector-func &key Number Fio Yearb Yearp MarkF MarkVM MarkPr)
    (mapcar
      #'(lambda (record)
          (when (funcall selector-func record)
            (if Number (setf (getf record :number) Number))
            (if NumRase (setf (getf record :NumRase) NumRase))
            (if Plane (setf (getf record :Plane) Plane))
          )
          record) 
      db)
  )

(defun NumRaseSelector (value)
  #'(lambda (x) (equal (getf x :NumRase) value) )
  )

(defun ShowPlaneToSity(db Sity)
  (dolist (elem db)
    (when (equal (getf elem :Destin) Sity) 
      (format t "~%~{~a:~10t~a~%~}" 
        (list :NumRase (getf elem :NumRase) :Plane (getf elem :Plane)) 
        ) 
      ) 
    )
  )
(defun PrintDB (db)
  (dolist (elem db)
    (format t "~%~{~a:~10t~a~%~}" elem))
  )
;----------------------------------------------------
(setf db (CreateDB "Moskow" 1 "TU-144"))
(setf db (AddRow db "Sevastopol" 2 "Pepelac"))
(setf db (AddRow db "Sevastopol" 3 "D22"))
(PrintDB db)
(ShowPlaneToSity db "Sevastopol")
(setf db (Update db (NumRaseSelector 3) :Destin "Sevastopol" :NumRase 3 :Plane "Gravicapa"))
;(SaveDB db "D:\\file.dat")
;(setf db (ReadDB "D:\\file.dat"))
;(PrintDB db)

